---

---

<script>
  import block from '../../public/block.wav'
  import {metronome} from '../stores'
  import * as Tone from 'tone';

  const tone = new Tone.Oscillator({
    type: "sine",
    frequency: 440,
    volume: -16
  }).toDestination();

  const player = new Tone.Player(block)
  const tb = new Tone.ToneAudioBuffer();

  metronome.subscribe((conf) => {
    Tone.Transport.bpm.value = conf.bpm;
    tb.onload = function() {
      player.loop = true;
      // Tone.Transport.scheduleRepeat(function(time) {
      //   console.log("playing audio")
      //   player.start(time)
      // }, "4n")
    }

    if(!conf.isMuted) {
      console.log("starting")
      // player.start();
      tone.start()
      // Tone.start();
      // Tone.Transport.start();
    } else {
      console.log("stopping")
      // Tone.stop();
      tone.stop()
      // Tone.Transport.stop();
      // player.stop();
    }
  })
</script>
